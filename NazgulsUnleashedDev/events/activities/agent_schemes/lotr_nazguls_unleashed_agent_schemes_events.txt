namespace = agent_schemes

agent_schemes.0001 = {
	title = agent_schemes.0001.t
	desc = agent_schemes.0001.desc
	type = character_event
	content_source = realms_dlc
	theme = murder_scheme
	left_portrait = {
		character = root
		animation = personality_dishonorable
	}
	lower_center_portrait = {
		character = scope:selected_agent_1
		animation = personality_dishonorable
	}
	lower_left_portrait = {
		character = scope:selected_agent_2
		animation = personality_dishonorable
	}
	lower_right_portrait = {
		character = scope:selected_agent_3
		animation = personality_dishonorable
	}
	override_background = { reference = throne_room_evil }

	immediate = {
		play_music_cue = "mx_cue_illness"

		#add_character_flag = {
		#	flag = planning_an_activity
		#	days = 30
		#}

		generate_schemes_list_on_start = yes

		ordered_courtier = {
			limit = {
				has_trait = indur_scheme_court
				NOT = {
					has_character_modifier = schemed_recently
				}
			}
			order_by = intrigue
			save_scope_as = selected_agent_1
		}
		ordered_courtier = {
			limit = {
				has_trait = indur_scheme_court
				NOT = {
					has_character_modifier = schemed_recently
					this = scope:selected_agent_1
				}
			}
			order_by = intrigue
			save_scope_as = selected_agent_2
		}
		ordered_courtier = {
			limit = {
				has_trait = indur_scheme_court
				NOR = {
					has_character_modifier = schemed_recently
					this = scope:selected_agent_1
					this = scope:selected_agent_2
				}
			}
			order_by = intrigue
			save_scope_as = selected_agent_3
		}		
	}

	option = { # Caster 1
		trigger = {
			exists = scope:selected_agent_1
		}
		name = agent_schemes.0001.a
		set_variable = {
			name = selected_agent
			value = scope:selected_agent_1
		}
	}

	option = { # Caster 2
		trigger = {
			exists = scope:selected_agent_2
		}
		name = agent_schemes.0001.b
		set_variable = {
			name = selected_agent
			value = scope:selected_agent_2
		}
	}

	option = { # Caster 3
		trigger = {
			exists = scope:selected_agent_3
		}
		name = agent_schemes.0001.c
		set_variable = {
			name = selected_agent
			value = scope:selected_agent_3
		}
	}

	option = { # You will do it
		name = agent_schemes.0001.d
		set_variable = {
			name = selected_agent
			value = root
		}
	}

}

# Steal Money
agent_schemes.0010 = {
	title = agent_schemes.0010.t
	desc = agent_schemes.0010.desc
	type = character_event
	content_source = realms_dlc
	theme = murder_scheme
	right_portrait = {
		character = var:selected_agent
		animation = paranoia
	}
	left_portrait = {
		character = scope:ruler_1
		animation = bold
	}
	lower_left_portrait = {
		character = scope:ruler_2
		animation = bold
	}
	lower_center_portrait = {
		character = scope:ruler_3
		animation = bold
	}
	lower_right_portrait = {
		character = scope:ruler_4
		animation = bold
	}
	override_background = { reference = throne_room_evil }

	immediate = {
		random_ruler = {
			limit = {
				NOR = {
					culture = root.location.culture
					#culture_group = root.location.culture_group
					culture = root.culture
					#culture_group = root.culture_group
					faith = root.faith
					empire = root.location.empire
					kingdom = root.location.kingdom
					top_liege = root.top_liege
					capital_county.title_province = {
						is_wastelands = yes
					}
				}
			}
			save_scope_as = ruler_1
		}
	
		random_ruler = {
			limit = {
				NOR = {
					culture = root.location.culture
					#culture_group = root.location.culture_group
					culture = root.culture
					#culture_group = root.culture_group
					faith = root.faith
					empire = root.location.empire
					kingdom = root.location.kingdom
					top_liege = root.top_liege
					capital_county.title_province = {
						is_wastelands = yes
					}
					# Variety
					top_liege = scope:ruler_1.top_liege
					culture = scope:ruler_1.culture
					faith = scope:ruler_1.faith
				}
			}
			save_scope_as = ruler_2
		}
		random_ruler = {
			limit = {
				NOR = {
					culture = root.location.culture
					#culture_group = root.location.culture_group
					culture = root.culture
					#culture_group = root.culture_group
					faith = root.faith
					empire = root.location.empire
					kingdom = root.location.kingdom
					top_liege = root.top_liege
					capital_county.title_province = {
						is_wastelands = yes
					}
					# Variety
					top_liege = scope:ruler_1.top_liege
					culture = scope:ruler_1.culture
					faith = scope:ruler_1.faith

					# Variety
					top_liege = scope:ruler_2.top_liege
					culture = scope:ruler_2.culture
					faith = scope:ruler_2.faith
				}
			}
			save_scope_as = ruler_3
		}

		random_ruler = {
			limit = {
				NOR = {
					culture = root.location.culture
					#culture_group = root.location.culture_group
					culture = root.culture
					#culture_group = root.culture_group
					faith = root.faith
					empire = root.location.empire
					kingdom = root.location.kingdom
					top_liege = root.top_liege
					capital_county.title_province = {
						is_wastelands = yes
					}
					# Variety
					top_liege = scope:ruler_1.top_liege
					culture = scope:ruler_1.culture
					faith = scope:ruler_1.faith

					# Variety
					top_liege = scope:ruler_2.top_liege
					culture = scope:ruler_2.culture
					faith = scope:ruler_2.faith

					# Variety
					top_liege = scope:ruler_3.top_liege
					culture = scope:ruler_3.culture
					faith = scope:ruler_3.faith
				}
			}
			save_scope_as = ruler_4
		}

		if = {
			limit = {  scope:ruler_1 = { gold > 100 } }
			set_variable = {
				name = stolen_gold_1
				value = 100
			}						
		}
		else_if =  {
			limit = {  scope:ruler_1 = { gold > 75 } }
			set_variable = {
				name = stolen_gold_1
				value = 75
			}
		}
		else_if =  {
			limit = {  scope:ruler_1 = { gold > 50 } }
			set_variable = {
				name = stolen_gold_1
				value = 50
			}
		}
		else =  {
			set_variable = {
				name = stolen_gold_1
				value = 25
			}
		}

		if = {
			limit = {  scope:ruler_2 = { gold > 100 } }
			set_variable = {
				name = stolen_gold_2
				value = 100
			}						
		}
		else_if =  {
			limit = {  scope:ruler_2 = { gold > 75 } }
			set_variable = {
				name = stolen_gold_2
				value = 75
			}
		}
		else_if =  {
			limit = {  scope:ruler_2 = { gold > 50 } }
			set_variable = {
				name = stolen_gold_2
				value = 50
			}
		}
		else =  {
			set_variable = {
				name = stolen_gold_2
				value = 25
			}
		}

		if = {
			limit = {  scope:ruler_3 = { gold > 100 } }
			set_variable = {
				name = stolen_gold_3
				value = 100
			}						
		}
		else_if =  {
			limit = {  scope:ruler_3 = { gold > 75 } }
			set_variable = {
				name = stolen_gold_3
				value = 75
			}
		}
		else_if =  {
			limit = {  scope:ruler_3 = { gold > 50 } }
			set_variable = {
				name = stolen_gold_3
				value = 50
			}
		}
		else =  {
			set_variable = {
				name = stolen_gold_3
				value = 25
			}
		}

		if = {
			limit = {  scope:ruler_4 = { gold > 100 } }
			set_variable = {
				name = stolen_gold_4
				value = 100
			}						
		}
		else_if =  {
			limit = {  scope:ruler_4 = { gold > 75 } }
			set_variable = {
				name = stolen_gold_4
				value = 75
			}
		}
		else_if =  {
			limit = {  scope:ruler_4 = { gold > 50 } }
			set_variable = {
				name = stolen_gold_4
				value = 50
			}
		}
		else =  {
			set_variable = {
				name = stolen_gold_4
				value = 25
			}
		}
	}
	
	option = { # Ruler 1
		name = agent_schemes.0010.a
		trigger = {
			exists = scope:ruler_1
		}
		random_list = {
			40 = {
				modifier = {
					add = var:selected_agent.intrigue
					multiply = 2
				}
				
				send_interface_toast = {
					title = agent_schemes.0010.tt.success
					left_icon = var:selected_agent
					right_icon = scope:ruler_1
				
					
					root = { add_gold = var:stolen_gold_1 }
					scope:ruler_1 = {
						remove_short_term_gold = root.var:stolen_gold_1
					}					
				}
			}
			60 = {
				modifier = {
					add = scope:ruler_1.cp:councillor_spymaster.intrigue
					factor = 1.1
				}
				modifier = {
					add = scope:ruler_1.capital_county.title_province.fort_level
					factor = 1.1
				}
				send_interface_toast = {					
					title = agent_schemes.0010.tt.failure
					left_icon = var:selected_agent
					right_icon = scope:ruler_1
					scope:ruler_1 = {
						add_opinion = {
							target = root
							modifier = unfriendly_opinion
							opinion = -25
						}
					}
					var:selected_agent = {
						increase_wounds_effect = { REASON = fight }
					}
				}
			}
		}
	}
	
	option = { # Ruler 2
		name = agent_schemes.0010.b
		trigger = {
			exists = scope:ruler_2
		}
		random_list = {
			40 = {
				modifier = {
					add = var:selected_agent.intrigue
					multiply = 2
				}
				
				send_interface_toast = {
					title = agent_schemes.0010.tt.success
					left_icon = var:selected_agent
					right_icon = scope:ruler_2
				
					
					root = { add_gold = var:stolen_gold_2 }
					scope:ruler_2 = {
						remove_short_term_gold = root.var:stolen_gold_2
					}					
				}
			}
			60 = {
				modifier = {
					add = scope:ruler_2.cp:councillor_spymaster.intrigue
					factor = 1.1
				}
				modifier = {
					add = scope:ruler_2.capital_county.title_province.fort_level
					factor = 1.1
				}
				send_interface_toast = {					
					title = agent_schemes.0010.tt.failure
					left_icon = var:selected_agent
					right_icon = scope:ruler_2
					scope:ruler_2 = {
						add_opinion = {
							target = root
							modifier = unfriendly_opinion
							opinion = -25
						}
					}
					var:selected_agent = {
						increase_wounds_effect = { REASON = fight }
					}
				}
			}
		}
	}

	option = { # Ruler 3
		name = agent_schemes.0010.c
		trigger = {
			exists = scope:ruler_3
		}
		random_list = {
			40 = {
				modifier = {
					add = var:selected_agent.intrigue
					multiply = 2
				}
				
				send_interface_toast = {
					title = agent_schemes.0010.tt.success
					left_icon = var:selected_agent
					right_icon = scope:ruler_3
				
					
					root = { add_gold = var:stolen_gold_3 }
					scope:ruler_3 = {
						remove_short_term_gold = root.var:stolen_gold_3
					}					
				}
			}
			60 = {
				modifier = {
					add = scope:ruler_3.cp:councillor_spymaster.intrigue
					factor = 1.1
				}
				modifier = {
					add = scope:ruler_3.capital_county.title_province.fort_level
					factor = 1.1
				}
				send_interface_toast = {					
					title = agent_schemes.0010.tt.failure
					left_icon = var:selected_agent
					right_icon = scope:ruler_3
					scope:ruler_3 = {
						add_opinion = {
							target = root
							modifier = unfriendly_opinion
							opinion = -25
						}
					}
					var:selected_agent = {
						increase_wounds_effect = { REASON = fight }
					}
				}
			}
		}
	}

	option = { # Ruler 4
		name = agent_schemes.0010.d
		trigger = {
			exists = scope:ruler_4
		}
		random_list = {
			40 = {
				modifier = {
					add = var:selected_agent.intrigue
					multiply = 2
				}
				
				send_interface_toast = {
					title = agent_schemes.0010.tt.success
					left_icon = var:selected_agent
					right_icon = scope:ruler_4
				
					
					root = { add_gold = var:stolen_gold_4 }
					scope:ruler_4 = {
						remove_short_term_gold = root.var:stolen_gold_4
					}					
				}
			}
			60 = {
				modifier = {
					add = scope:ruler_4.cp:councillor_spymaster.intrigue
					factor = 1.1
				}
				modifier = {
					add = scope:ruler_4.capital_county.title_province.fort_level
					factor = 1.1
				}
				send_interface_toast = {					
					title = agent_schemes.0010.tt.failure
					left_icon = var:selected_agent
					right_icon = scope:ruler_4
					scope:ruler_4 = {
						add_opinion = {
							target = root
							modifier = unfriendly_opinion
							opinion = -25
						}
					}
					var:selected_agent = {
						increase_wounds_effect = { REASON = fight }
					}
				}
			}
		}
	}

	option = { # On a better thought
		name = agent_schemes.0010.e
		
		var:selected_agent = {
			remove_character_modifier = schemed_recently
		}
	}
}


# Steal Artifact
agent_schemes.0020 = {
	title = agent_schemes.0020.t
	desc = agent_schemes.0020.desc
	type = character_event
	content_source = realms_dlc
	theme = murder_scheme
	right_portrait = {
		character = var:selected_agent
		animation = paranoia
	}
	left_portrait = {
		character = scope:artifact_1.artifact_owner
		animation = bold
	}
	lower_left_portrait = {
		character = scope:artifact_2.artifact_owner
		animation = bold
	}
	lower_center_portrait = {
		character = scope:artifact_3.artifact_owner
		animation = bold
	}
	lower_right_portrait = {
		character = scope:artifact_4.artifact_owner
		animation = bold
	}
	override_background = { reference = throne_room_evil }

	immediate = {
		random_artifact = {
			limit = {
				artifact_owner = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						AND = {
							artifact_owner = { 
								is_nazgul = yes
							}
							is_nazgul = yes
						}
					}
				}
			}					
			save_scope_as = artifact_1
		}

		random_artifact = {
			limit = {
				artifact_owner = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						this = scope:artifact_1
						AND = {
							artifact_owner = { 
								is_nazgul = yes
							}
							is_nazgul = yes
						}
					}
				}
			}					
			save_scope_as = artifact_2
		}
		
		random_artifact = {
			limit = {
				artifact_owner = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						this = scope:artifact_1
						this = scope:artifact_2
						AND = {
							artifact_owner = { 
								is_nazgul = yes
							}
							is_nazgul = yes
						}
					}
				}
			}					
			save_scope_as = artifact_3
		}

		random_artifact = {
			limit = {
				artifact_owner = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						this = scope:artifact_1
						this = scope:artifact_2
						this = scope:artifact_3
						AND = {
							artifact_owner = { 
								is_nazgul = yes
							}
							is_nazgul = yes
						}
					}
				}
			}					
			save_scope_as = artifact_4
		}
	}
	
	option = { # Artifact 1
		trigger = {
			exists = scope:artifact_1
		}
		name = agent_schemes.0020.a
	}

	option = { # Artifact 2
		trigger = {
			exists = scope:artifact_2
		}
		name = agent_schemes.0020.b
	}

	option = { # Artifact 3		
		trigger = {
			exists = scope:artifact_3
		}
		name = agent_schemes.0020.c
	}

	option = { # Artifact 4
		trigger = {
			exists = scope:artifact_4
		}
		name = agent_schemes.0020.d
	}

	option = { # On a better thought
		name = agent_schemes.0020.e
		var:selected_agent = {
			remove_character_modifier = schemed_recently
		}
	}
}

# Murder
agent_schemes.0030 = {
	title = agent_schemes.0030.t
	desc = agent_schemes.0030.desc
	type = character_event
	content_source = realms_dlc
	theme = murder_scheme
	right_portrait = {
		character = var:selected_agent
		animation = assassin
	}
	left_portrait = {
		character = scope:target_1
		animation = bold
	}
	lower_left_portrait = {
		character = scope:target_2
		animation = bold
	}
	lower_center_portrait = {
		character = scope:target_3
		animation = bold
	}
	lower_right_portrait = {
		character = scope:target_4
		animation = bold
	}
	override_background = { reference = throne_room_evil }

	immediate = {
		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}
					}
				}
				save_scope_as = target_1
			}
		}

		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}

						scope:target_1.top_liege = top_liege
					}
				}
				save_scope_as = target_2
			}
		}	

		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}

						scope:target_1.top_liege = top_liege
						scope:target_2.top_liege = top_liege
					}
				}
				save_scope_as = target_3
			}
		}	

		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}

						scope:target_1.top_liege = top_liege
						scope:target_2.top_liege = top_liege
						scope:target_3.top_liege = top_liege
					}
				}
				save_scope_as = target_4
			}
		}	

	}
	
	option = { # Province 1
		trigger = {
			exists = scope:target_1
		}
		name = agent_schemes.0030.a
	}

	option = { # Province 2
		trigger = {
			exists = scope:target_2
		}
		name = agent_schemes.0030.b
	}

	option = { # Province 3		
		trigger = {
			exists = scope:target_3
		}
		name = agent_schemes.0030.c
	}

	option = { # Province 4
		trigger = {
			exists = scope:target_4
		}
		name = agent_schemes.0030.d
	}

	option = { # On a better thought
		name = agent_schemes.0030.e
		var:selected_agent = {
			remove_character_modifier = schemed_recently
		}
	}
}

agent_schemes.0040 = {
	title = agent_schemes.0040.t
	desc = agent_schemes.0040.desc
	type = character_event
	content_source = realms_dlc
	theme = murder_scheme
	right_portrait = {
		character = var:selected_agent
		animation = eavesdrop
	}
	left_portrait = {
		character = scope:target_1
		animation = bold
	}
	lower_left_portrait = {
		character = scope:target_2
		animation = bold
	}
	lower_center_portrait = {
		character = scope:target_3
		animation = bold
	}
	lower_right_portrait = {
		character = scope:target_4
		animation = bold
	}
	override_background = { reference = throne_room_evil }

	immediate = {
		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}
					}
				}
				save_scope_as = target_1
			}
		}

		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}

						scope:target_1.top_liege = top_liege
					}
				}
				save_scope_as = target_2
			}
		}	

		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}

						scope:target_1.top_liege = top_liege
						scope:target_2.top_liege = top_liege
					}
				}
				save_scope_as = target_3
			}
		}	

		random_ruler = {
			random_courtier = {
				limit = {
					NOR = {
						culture = root.location.culture
						#culture_group = root.location.culture_group
						culture = root.culture
						#culture_group = root.culture_group
						faith = root.faith
						top_liege = root.top_liege
						is_wastelands = yes
						
						AND = {
							is_nazgul = yes
							root = {
								is_nazgul = yes
							}
						}

						scope:target_1.top_liege = top_liege
						scope:target_2.top_liege = top_liege
						scope:target_3.top_liege = top_liege
					}
				}
				save_scope_as = target_4
			}
		}	
	}
	
	option = { # Secret Owner 1
		trigger = {
			exists = scope:target_1
		}
		name = agent_schemes.0040.a
	}

	option = { # Secret Owner 2
		trigger = {
			exists = scope:target_2
		}
		name = agent_schemes.0040.b
	}

	option = { # Secret Owner 3
		trigger = {
			exists = scope:target_3
		}
		name = agent_schemes.0040.c
	}

	option = { # Secret Owner 4
		trigger = {
			exists = scope:target_4
		}
		name = agent_schemes.0040.d
	}

	option = { # On a better thought
		name = agent_schemes.0040.e
		var:selected_agent = {
			remove_character_modifier = schemed_recently
		}
	}
}